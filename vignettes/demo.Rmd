---
title: "pirouette demo"
author: "Richel J.C. Bilderbeek"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{pirouette demo}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

The goal of `pirouette` is to estimate the error BEAST2 makes from a known 
phylogeny. This phylogeny can be created using a non-BEAST speciation model,
for example the PBD or MBD models.

```{r}
library(pirouette)
```

In this demo, we use a simple 'true' phylogeny:

```{r}
true_phylogeny <- ape::read.tree(text = "(((A:1, B:1):1, C:2):1, D:3);")
ape::plot.phylo(true_phylogeny, main = "The 'true' phylogeny")
```

As this vignette is a demo (and not a thorough research), 
we'll use a short alignment:

```{r}
alignment_params <- create_alignment_params(
  root_sequence = create_blocked_dna(length = 20),
  mutation_rate = 1.0 / beautier:::get_phylo_crown_age(true_phylogeny)
)
```

we use an MCMC chain that is short:

```{r}
inference_params <- create_inference_params(
  mcmc = beautier::create_mcmc(chain_length = 5000, store_every = 1000),
  rng_seed = 42
)
```

Here we measure the error:

```{r}
errors <- pir_run(
  true_phylogeny,
  alignment_params = alignment_params,
  inference_params = inference_params
)
```

Here we show the errors as a table:

```{r}
knitr::kable(head(errors))
```

Here we plot the error:

```{r fig.width=7, fig.height=7}
pir_plot(errors)
```
